<section
  class="py-20 px-6"
  data-aos="fade-up"
  data-aos-duration="800"
  aria-labelledby="contacto-titulo"
>
  <div class="sm:grid grid-cols-2 gap-3 justify-center">
    <!-- FORMULARIO -->
    <div class="sm:pl-8">
      <h2 id="contacto-titulo" class="sr-only">Formulario de contacto</h2>

      <form
        id="contactForm"
        class="space-y-6"
        aria-label="Formulario de contacto"
        on:submit.prevent
        action="http://localhost:8000/contact.php"
        method="POST"
      >
        <div class="flex flex-col sm:flex-row gap-2">
          <div class="flex-1">
            <label for="name" class="block text-left font-medium mb-1">
              Nombre y Apellido <span aria-hidden="true">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              autocomplete="name"
              class="w-full py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div class="flex-1">
            <label for="email" class="block text-left font-medium mb-1">
              Correo electrónico <span aria-hidden="true">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              autocomplete="email"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-2">
          <div class="flex-1">
            <label for="phone" class="block text-left font-medium mb-1">
              Celular
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              autocomplete="tel"
              class="w-full py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div class="flex-1">
            <label for="location" class="block text-left font-medium mb-1">
              País / Ciudad
            </label>
            <input
              type="text"
              id="location"
              name="location"
              autocomplete="address-level2"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <div>
          <label for="message" class="block text-left font-medium mb-1">
            Consulta <span aria-hidden="true">*</span>
          </label>
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <div class="text-center">
          <button
            type="submit"
            class="px-8 py-3 bg-[#1d3557] text-white font-medium text-lg rounded-full shadow-lg border-2 border-transparent
            transition-all duration-300 ease-in-out
            hover:bg-white hover:text-blue-600 hover:border-blue-600
            active:bg-[#1d3557] active:text-black active:border-yellow-500 active:shadow-xl mt-5"
          >
            Enviar
          </button>
        </div>

        <p
          id="responseMsg"
          class="mt-4 text-sm text-green-600 hidden"
          role="status"
          aria-live="polite"
        >
          ¡Mensaje enviado correctamente!
        </p>
      </form>
    </div>

    <!-- INFORMACIÓN DE CONTACTO -->
    <div class="pl-5 flex flex-col items-center">
      <h2
        class="font-serif text-3xl sm:text-4xl font-semibold text-center mb-8 mt-[40%] sm:mt-[8%]"
        data-aos="fade-down"
      >
        Contacto directo
      </h2>

      <address
        class="not-italic text-center space-y-6 text-lg"
        aria-label="Información de contacto"
      >
        <!-- WhatsApp -->
        <div
          class="flex items-center justify-center gap-2"
          data-aos="fade-right"
          data-aos-delay="200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-green-500"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              d="M20.52 3.48A11.91 11.91 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.12.55 4.19 1.6 6.03L0 24l6.2-1.63A11.92 11.92 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.19-1.24-6.19-3.48-8.52zM12 21.6c-1.87 0-3.69-.5-5.3-1.45l-.38-.22-3.68.97.98-3.58-.25-.37A9.61 9.61 0 0 1 2.4 12c0-5.3 4.3-9.6 9.6-9.6s9.6 4.3 9.6 9.6-4.3 9.6-9.6 9.6zm5.27-7.11c-.29-.14-1.73-.85-2-1-.27-.1-.46-.14-.65.14-.19.29-.75 1-.92 1.19-.17.19-.34.22-.63.07-.29-.14-1.22-.45-2.33-1.45-.86-.77-1.44-1.73-1.61-2.02-.17-.29-.02-.45.13-.59.13-.13.29-.34.43-.51.14-.17.19-.29.29-.48.1-.19.05-.36-.02-.51-.07-.14-.65-1.56-.89-2.14-.23-.56-.48-.48-.65-.48-.17 0-.36 0-.55 0s-.51.07-.77.36c-.27.29-1.02 1-1.02 2.43s1.05 2.82 1.2 3.01c.14.19 2.06 3.14 5 4.41.7.31 1.25.5 1.67.64.7.22 1.34.19 1.84.12.56-.08 1.73-.71 1.98-1.39.25-.68.25-1.26.18-1.39-.07-.13-.26-.21-.55-.35z"
            ></path>
          </svg>
          <a
            href="https://wa.me/5491144110025?text=Hola%20Silvia%2C%20quisiera%20hacerte%20una%20consulta..."
            target="_blank"
            rel="noopener noreferrer"
            class="hover:underline"
          >
            +54 9 11 4411-0025
          </a>
        </div>

        <!-- Email -->
        <div
          class="flex items-center justify-center gap-2"
          data-aos="fade-left"
          data-aos-delay="300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-[#a8dadc]"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path d="M2.01 6L12 13l9.99-7H2.01zM2 18V8l10 7 10-7v10H2z"></path>
          </svg>
          <a
            href="https://mail.google.com/mail/?view=cm&fs=1&to=susach48@gmail.com"
            class="hover:underline"
            target="_blank"
            rel="noopener noreferrer"
          >
            susach48@gmail.com
          </a>
        </div>
      </address>
    </div>
  </div>
</section>

<script type="module">
    const contactForm = document.getElementById("contactForm");
    const responseMsg = document.getElementById("responseMsg");
    const submitBtn = contactForm.querySelector('button[type="submit"]');

    if (contactForm && responseMsg && submitBtn) {
      const TXT_SEND = "Enviar";
      const TXT_SENDING = "Enviando...";
      const TXT_OK = "¡Mensaje enviado correctamente!";
      const TXT_ERR = "No se pudo enviar el mensaje.";
      const TXT_NET = "Error de red. Intentá de nuevo.";

      function setStatus(message, ok = true) {
        responseMsg.textContent = message;
        responseMsg.classList.remove("hidden");
        responseMsg.classList.toggle("text-green-600", ok);
        responseMsg.classList.toggle("text-red-600", !ok);
      }

      contactForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        setStatus(TXT_SENDING, true);
        submitBtn.disabled = true;
        submitBtn.textContent = TXT_SENDING;

        try {
          const res = await fetch(contactForm.action, {
            method: "POST",
            body: new FormData(contactForm),
            headers: { Accept: "application/json" },
          });

          // Debug visible en consola
          let peek = {};
          try {
            peek = await res.clone().json();
          } catch {
            try {
              peek = { text: await res.clone().text() };
            } catch {}
          }
          console.log("Contacto PHP:", res.status, peek);

          if (res.ok) {
            contactForm.reset();
            setStatus(TXT_OK, true);
          } else {
            // Mensaje claro según código
            if (res.status === 422) {
              setStatus("Datos inválidos. Revisá los campos requeridos.", false);
            } else if (res.status === 429) {
              setStatus("Demasiadas solicitudes. Probá en unos minutos.", false);
            } else if (res.status === 413) {
              setStatus("Mensaje demasiado largo.", false);
            } else if (!res.ok) {
              setStatus(peek?.error || `Error ${res.status}`, false);
            } else {
              contactForm.reset();
              setStatus(TXT_OK, true);
            }
          }
        } catch {
          setStatus(TXT_NET, false);
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = TXT_SEND;
        }
      });
    }
  </script>

<!-- <script type="module">
  const form = document.getElementById("contactForm");
  const responseMsg = document.getElementById("responseMsg");
  const submitBtn = form.querySelector('button[type="submit"]');

  function setStatus(message, ok = true) {
    responseMsg.textContent = message;
    responseMsg.classList.remove("hidden");
    responseMsg.classList.toggle("text-green-600", ok);
    responseMsg.classList.toggle("text-red-600", !ok);
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.classList.add("opacity-60", "cursor-not-allowed");
    setStatus("Enviando...", true);

    try {
      const fd = new FormData(form);
      const payload = {
        to: "federicodiaz1981@gmail.com", //'susach48@gmail.com',
        subject: `Consulta web: ${fd.get("name") || "Sin nombre"}`,
        text: `
Nombre: ${fd.get("name") || "-"}
Email: ${fd.get("email") || "-"}
Celular: ${fd.get("phone") || "-"}
Ubicación: ${fd.get("location") || "-"}
Mensaje:
${fd.get("message") || "-"}
        `.trim(),
        html: `
<p><strong>Nombre:</strong> ${fd.get("name") || "-"}</p>
<p><strong>Email:</strong> ${fd.get("email") || "-"}</p>
<p><strong>Celular:</strong> ${fd.get("phone") || "-"}</p>
<p><strong>Ubicación:</strong> ${fd.get("location") || "-"}</p>
<p><strong>Mensaje:</strong></p>
<p>${(fd.get("message") || "-").replace(/\n/g, "<br/>")}</p>
        `.trim(),
      };

      const res = await fetch("/send-email.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));

      if (res.ok) {
        setStatus("¡Mensaje enviado correctamente!", true);
        form.reset();
      } else {
        const err = data?.error || "Error enviando mail";
        setStatus(err, false);
      }
    } catch (err) {
      console.error("Fetch error:", err);
      setStatus("Error de red o servidor", false);
    } finally {
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
    }
  });
</script> -->
