<section
  class="py-20 px-6"
  data-aos="fade-up"
  data-aos-duration="800"
  aria-labelledby="contacto-titulo"
>
  <div class="sm:grid grid-cols-2 gap-3 justify-center">
    <!-- FORMULARIO -->
    <div class="sm:pl-8">
      <h2 id="contacto-titulo" class="sr-only">Formulario de contacto</h2>

      <form
        id="contactForm"
        class="space-y-6"
        aria-label="Formulario de contacto"
      >
        <div class="flex flex-col sm:flex-row gap-2">
          <div class="flex-1">
            <label for="name" class="block text-left font-medium mb-1">
              Nombre y Apellido <span aria-hidden="true">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              autocomplete="name"
              class="w-full py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div class="flex-1">
            <label for="email" class="block text-left font-medium mb-1">
              Correo electrónico <span aria-hidden="true">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              autocomplete="email"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-2">
          <div class="flex-1">
            <label for="phone" class="block text-left font-medium mb-1">
              Celular
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              autocomplete="tel"
              class="w-full py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div class="flex-1">
            <label for="location" class="block text-left font-medium mb-1">
              País / Ciudad
            </label>
            <input
              type="text"
              id="location"
              name="location"
              autocomplete="address-level2"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <div>
          <label for="message" class="block text-left font-medium mb-1">
            Consulta <span aria-hidden="true">*</span>
          </label>
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <div class="text-center">
          <button
            type="submit"
            class="px-8 py-3 bg-[#1d3557] text-white font-medium text-lg rounded-full shadow-lg border-2 border-transparent
            transition-all duration-300 ease-in-out
            hover:bg-white hover:text-blue-600 hover:border-blue-600
            active:bg-[#1d3557] active:text-black active:border-yellow-500 active:shadow-xl mt-5"
          >
            Enviar
          </button>
        </div>

        <p
          id="responseMsg"
          class="mt-4 text-sm text-green-600 hidden"
          role="status"
          aria-live="polite"
        >
          ¡Mensaje enviado correctamente!
        </p>
      </form>
    </div>

    <!-- INFORMACIÓN DE CONTACTO -->
    <div class="pl-5 flex flex-col items-center">
      <h2
        class="font-serif text-3xl sm:text-4xl font-semibold text-center mb-8 mt-[40%] sm:mt-[8%]"
        data-aos="fade-down"
      >
        Contacto directo
      </h2>

      <address
        class="not-italic text-center space-y-6 text-lg"
        aria-label="Información de contacto"
      >
        <!-- WhatsApp -->
        <div
          class="flex items-center justify-center gap-2"
          data-aos="fade-right"
          data-aos-delay="200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-green-500"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path d="..."></path>
          </svg>
          <a
            href="https://wa.me/5491144110025?text=Hola%20Silvia%2C%20quisiera%20hacerte%20una%20consulta..."
            target="_blank"
            rel="noopener noreferrer"
            class="hover:underline"
          >
            +54 9 11 4411-0025
          </a>
        </div>

        <!-- Email -->
        <div
          class="flex items-center justify-center gap-2"
          data-aos="fade-left"
          data-aos-delay="300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-[#a8dadc]"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path d="..."></path>
          </svg>
          <a
            href="https://mail.google.com/mail/?view=cm&fs=1&to=susach48@gmail.com"
            class="hover:underline"
            target="_blank"
            rel="noopener noreferrer"
          >
            susach48@gmail.com
          </a>
        </div>
      </address>
    </div>
  </div>
</section>
<script type="module">
  const form = document.getElementById('contactForm');
  const responseMsg = document.getElementById('responseMsg');
  const submitBtn = form.querySelector('button[type="submit"]');

  function setStatus(message, ok = true) {
    responseMsg.textContent = message;
    responseMsg.classList.remove('hidden');
    responseMsg.classList.toggle('text-green-600', ok);
    responseMsg.classList.toggle('text-red-600', !ok);
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    // Disable botón para evitar doble envío
    submitBtn.disabled = true;
    submitBtn.classList.add('opacity-60', 'cursor-not-allowed');
    setStatus('Enviando...', true);

    try {
      const fd = new FormData(form);
      const payload = {
        // Destinatario (por ahora lo ponemos fijo en cliente; ideal: definirlo en el servidor)
        to: 'susach48@gmail.com',
        subject: `Consulta web: ${fd.get('name') || 'Sin nombre'}`,
        // Incluimos info útil en el cuerpo
        text: `
Nombre: ${fd.get('name') || '-'}
Email: ${fd.get('email') || '-'}
Celular: ${fd.get('phone') || '-'}
Ubicación: ${fd.get('location') || '-'}
Mensaje:
${fd.get('message') || '-'}
        `.trim(),
        // opcional: html si tu endpoint lo admite
        html: `
<p><strong>Nombre:</strong> ${fd.get('name') || '-'}</p>
<p><strong>Email:</strong> ${fd.get('email') || '-'}</p>
<p><strong>Celular:</strong> ${fd.get('phone') || '-'}</p>
<p><strong>Ubicación:</strong> ${fd.get('location') || '-'}</p>
<p><strong>Mensaje:</strong></p>
<p>${(fd.get('message') || '-').replace(/\n/g, '<br/>')}</p>
        `.trim()
      };

      const res = await fetch('../../pages/api/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));

      if (res.ok) {
        setStatus('¡Mensaje enviado correctamente!', true);
        form.reset();
      } else {
        // Mensaje de error del servidor si existe
        const err = data?.error || 'Error enviando mail';
        setStatus(err, false);
      }
    } catch (err) {
      console.error('Fetch error:', err);
      setStatus('Error de red o servidor', false);
    } finally {
      submitBtn.disabled = false;
      submitBtn.classList.remove('opacity-60', 'cursor-not-allowed');
    }
  });
</script>

